# IP、TCP和DNS与HTTP的密切关系

## IP协议的概念

英文为Internet Protocol，翻译成网际协议，位于网络层。

这个网际协议这个名字听起来有点夸张，但事实就是这样，因为几乎所有使用网络的系统都会用到IP协议。TCP/IP协议族中的IP指的是网际协议，它在协议名称中占据了一半的位置，从这可以知道IP协议是多么的重要。这里我们需要注意两个概念，IP和IP地址，可能有人会把它搞混。IP其实是一种协议的名称，而IP地址是一个地址

## IP的作用
把各种数据包传送给对方。如果要保证确定传送到对方那里，则需要满足各类条件，其中最重要的两个条件是IP地址和MAC地址。

(1)IP地址：指明了节点被分配到的地址

(2)MAC地址：是指网卡所属的固定地址

(3)区别：IP地址可变换，但MAC地址基本上不会更改。


什么是IP地址呢?IP地址指明了节点被分配到的地址。而什么又是MAC地址呢? MAC地址的网卡所属的固定地址。形象一点来说，MAC地址就像我们的身份证号，每一个MAC地址是唯一的，并且基本不会改变。这里我为什么说基本不会改变呢?因为目前我们可以通过软件修改，也就是用软件来修改MAC地址。IP地址是可以和MAC地址进行配对的。


## 我们来了解一下使用ARP协议凭借MAC地址进行通信

什么是ARP协议呢?ARP协议它是一种用以解析地址的协议，我们只要知道通信方的IP地址，就可以反查出对应的MAC地址。也就是说IP间的通信依赖于MAC地址。来看一下这个图
![](http://s4.51cto.com/wyfs02/M02/74/BE/wKiom1YoRs7CU_w1AAEcnvPHScI360.jpg-wh_651x-s_3336173167.jpg)

在网络上，通信的双方通常都是要经过多台计算机或者网络设备中转才能连接到对方。而在进行中转时，会利用下一站中转设备的MAC地址来搜索下一个中转目标，这时我们就是靠ARP协议来进行处理。

## TCP协议的概念和作用

(1)TCP的概念：TCP英文为Transmission Control Protocol ，翻译成传输控制协议，位于传输层。

(2)TCP有什么作用呢?它是提供可靠的 字节流服务。

(3)什么是字节流服务?所谓的字节流服务指的是，为了方便传输，将大块数据分割成 以报文段为单位的数据包 进行管理

(4)为何强调可靠呢?因为它能够把数据准确可靠地传送给对方。总而言之，TCP协议就是为了更容易传送大数据才把数据分割，而且TCP协议能够确认数据 最终是否送达对方。

(5)TCP协议如何才能保证提供可靠的服务?它采用了三次握手策略。 也就是用TCP协议 把数据包送出去后，它不会对传送后的情况置之不理，它一定会想对方确认 是否成功送达。

## TCP协议的三次握手过程

![](http://s4.51cto.com/wyfs02/M02/74/BB/wKioL1YoRvmjkVXvAAC4q21KR9E407.jpg-wh_600x-s_3531074114.jpg)

### 三次握手解释

为了准确无误地把数据送达目标处，TCP协议采用了三次握手策略。用TCP协议把数据包送出去后，TCP不会对传送 后的情况置之不理，它一定会向对方确认是否成功送达。握手过程中使用了TCP的标志：SYN和ACK。

发送端首先发送一个带SYN标志的数据包给对方。接收端收到后，回传一个带有SYN/ACK标志的数据包以示传达确认信息。 最后，发送端再回传一个带ACK标志的数据包，代表“握手”结束。 若在握手过程中某个阶段莫名中断，TCP协议会再次以相同的顺序发送相同的数据包。

>断开一个TCP连接则需要“四次握手”：

- 第一次挥手：主动关闭方发送一个`FIN`，用来关闭主动方到被动关闭方的数据传送，也就是主动关闭方告诉被动关闭方：我已经不 会再给你发数据了(当然，在fin包之前发送出去的数据，如果没有收到对应的ack确认报文，主动关闭方依然会重发这些数据)，但是，此时主动关闭方还可 以接受数据。

- 第二次挥手：被动关闭方收到`FIN`包后，发送一个`ACK`给对方，确认序号为收到序号`+1`（与`SYN`相同，一个`FIN`占用一个序号）。

- 第三次挥手：被动关闭方发送一个`FIN`，用来关闭被动关闭方到主动关闭方的数据传送，也就是告诉主动关闭方，我的数据也发送完了，不会再给你发数据了。

- 第四次挥手：主动关闭方收到`FIN`后，发送一个`ACK`给被动关闭方，确认序号为收到序号+1，至此，完成四次挥手。

## DNS的概念与作用

(1)DNS的概念：英文为Domain Name System ，翻译成域名系统，位于应用层。

(2)DNS有什么作用呢? 它是提供域名到IP地址之间的解析服务


我们平时访问一个网站，通常都是使用主机名或域名来访问，而不是直接通过IP地址来访问。为什么我们不用IP地址去访问呢?因为IP地址是一组纯数字，比较难记。比如说，我们百度首页的IP地址为119.75.217.109,而域名为www.baidu.com。 如果我们用IP地址去访问网站，那是很难记得住的。而用域名就比较容易记住了。但是呢，计算机和人不一样，你要计算机去理解名称，相对来说就比较困难了。计算机比较擅长处理一长串数字。为了解决这个问题，就有了DNS服务。DNS协议它是提供 通过域名 来查找IP地址，或者逆向 从IP地址反查域名 的服务。

## HTTP与TCP、IP和DNS的关系

![](http://s4.51cto.com/wyfs02/M02/74/BB/wKioL1YoRvrTUPArAAIBXi3WXy0131.jpg-wh_600x-s_2189687316.jpg)

首先是，我想访问网站，将域名发送给DNS去解析，DNS解析后将网站的IP地址返回给客户端，然后通过IP地址发起HTTP请求。HTTP此时的作用是 生成针对目标WEB服务器(我们这里指的是网站的服务器)的HTTP请求报文，然后将请求报文传送给传输层，此时为了方便通信，TCP会将HTTP请求报文 分割成报文段，这些报文段会有一个序号，这里的报文段哪一个先发送哪一个先到达，它们是按序传送的。只要建立起TCP连接，客户端与服务器之间的报文交换就不会丢失，不会被破坏，也不会在接收时出现错序。接着到了网络层，此时IP协议的职责是，搜索对方的地址，一边中转一边传送。然后找到了服务器的位置，此时服务器的传输层中 TCP的职责是 接收到对方传送过来的报文段后，对其进行重组，这里的重组是按序号进行重组的。然后到了服务器的应用层，HTTP会对客户端请求的内容进行处理。处理完后，服务器同样会利用TCP/IP通信协议向客户端进行回传响应。最后客户端收到响应后，将内容输出页面显示。即完成了一次HTTP事务。